(()=>{let e=document.createElement("input");e.type="text",e.id="searchBar",e.placeholder="Search...",document.body.appendChild(e);let t=document.createElement("button");t.id="searchButton",t.textContent="Go",document.body.appendChild(t);let n=document.createElement("ul");n.id="results",document.body.appendChild(n);let o=document.createElement("p");o.id="error-message",document.body.appendChild(o),document.getElementById("searchButton").addEventListener("click",(async function(){try{const e=await new Promise(((e,t)=>{const n=document.getElementById("searchBar");if(!n)return void t(new Error("Search bar not found"));const o=n.value.trim();o?e(o):t(new Error("Category value is empty"))})),t=await async function(e){try{if(!e)throw new Error("Category value is empty");const t=await fetch(`https://openlibrary.org/subjects/${e}.json`);if(console.log(t),!t.ok)throw new Error("Bad Request");return await t.json()}catch(e){console.error(e)}}(e);!async function(e){const t=document.getElementById("results");if(!t)throw new Error("Results element not found");if(t.innerHTML="",!e||!e.works)throw new Error("Invalid data");e.works.forEach((async e=>{const n=e.authors?e.authors.map((e=>e.name)).join(", "):"",o=document.createElement("li");o.textContent=`${e.title||""} by ${n}`,o.id="resultElement",o.dataset.bookKey=e.key,t.appendChild(o);const r=document.createElement("div");r.id="descriptionContainer",o.appendChild(r);const a=document.createElement("p");a.id="descriptionElement",a.dataset.bookKey=e.key,r.appendChild(a),r.style.display="none",o.addEventListener("click",(function(e){const t=e.target.querySelector("#descriptionContainer");t&&(document.querySelectorAll("#descriptionContainer").forEach((e=>{e!==t&&(e.style.display="none")})),t.style.display="none"===t.style.display?"block":"none")})),async function(e){try{const t=await fetch(`https://openlibrary.org${e}.json`);if(303===t.status){const e=t.headers.get("Location"),n=await fetch(e);return await n.json()}if(!t.ok)throw new Error("Failed to fetch book data");return await t.json()}catch(e){return console.error("Error fetching book data:",e),null}}(e.key).then((e=>{if(!e)return void console.error("fetchBookData failed");console.log("fetchBookData success",e);const t=document.createElement("p");t.textContent=e.description.value||e.description,a.innerHTML="",a.appendChild(t)})).catch((e=>{console.error("fetchBookData failed: ",e)}))}))}(t)}catch(e){displayErrorMessage(e)}}))})();